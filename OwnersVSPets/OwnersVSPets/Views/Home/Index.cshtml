<div class="page-header">
    <h1> All users </h1>
</div>
<div class="panel">
     <div class="form-inline">
        <div class="form-group">
            <div class="col-md-8">
                <input class="form-control" ng-model="ownerName" placeholder="Name" />
            </div>
        </div>
        <div class="form-group">
            <div class="col-md-offset-1 col-md-8">
                <button class="btn btn-default" ng-click="addOwner(ownerName)">Add</button>
            </div>
        </div>
    </div>
    <div>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Pets count</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="owner in owners">
                    <td>{{owner.Name}}</td>
                    <td>{{owner.PetsAmount}}</td>
                    <td> <input class="btn btn-default" type="button" value="Delete" data-ng-click="deleteOwner(owner.Name)" /> </td>
                </tr>
            </tbody>
        </table>
        <p>
            Pages
            <span ng-show="skipStartPages">...</span>
            <span style="padding-left:5px;" ng-repeat="page in pages"><a ng-click="getOwners(page)">{{page}}</a></span>
            <span style="padding-left:5px;" ng-show="skipEndPages">...</span>
        </p>
    </div>
</div>
@section Scripts { 
    <script>
        var opApp = angular.module('ownersPetsApp', []);
        opApp.controller("ownersPetsController", function ($scope, $http) {
            $scope.skipStartPages = false;
            $scope.skipEndPages = false;
            $scope.pages = [];
            $scope.getOwners = function (fromPage) {
                $http({ method: 'GET', url: 'api/values' }).
                    then(function success(response) {
                        console.log(response.data);
                        var ownerList = response.data;
                        $scope.skipStartPages = false;
                        $scope.skipEndPages = false;
                        if (ownerList.length) {
                            if (fromPage===undefined) {
                                fromPage = 1;
                            } else {
                                fromPage = +fromPage;
                                if (fromPage < 1) {
                                    fromPage = 1;
                                }
                            }
                            var ownersOnPage = 3;
                            var ownersTotally = 20;
                            var maxPagesAmount = 5;
                            var actualPagesAmount = Math.ceil(ownersTotally / ownersOnPage);
                            if (actualPagesAmount > maxPagesAmount) {
                                if (actualPagesAmount > (fromPage + maxPagesAmount - 1)) {
                                    $scope.skipEndPages = true;
                                }
                                if (fromPage > (actualPagesAmount - maxPagesAmount + 1)) {
                                    fromPage = actualPagesAmount - maxPagesAmount + 1;
                                }
                                if (fromPage<1) {
                                    fromPage = 1;
                                }
                                if (fromPage > 1) {
                                    $scope.skipStartPages = true;
                                }
                            }
                            $scope.pages = [];
                            for (var i = fromPage; i < (fromPage + maxPagesAmount); i++) {
                                if (i > actualPagesAmount) {
                                    break;
                                }
                                $scope.pages[$scope.pages.length] = i;
                            }
                        }
                        $scope.owners = ownerList;
                    }, function error(response) {
                        console.log(response.data);
                    })
            };
            $scope.getOwners();
            $scope.addOwner = function (ownerName) {
                if (ownerName) {
                    $http({ method: 'PUT', url: 'api/values', params: { 'ownerName': ownerName } }).
                        then(function success(response) {
                            console.log(response.data);
                            $scope.owners = response.data;
                        }, function error(response) {
                            console.log(response.data);
                        })
                }    
            }
            $scope.deleteOwner = function (ownerName) {
                if (ownerName) {
                    $http({ method: 'DELETE', url: 'api/values', params: { 'ownerName': ownerName } }).
                        then(function success(response) {
                            console.log(response.data);
                            $scope.owners = response.data;
                        }, function error(response) {
                            console.log(response.data);
                        })
                }
            }
    });
    </script>
}
